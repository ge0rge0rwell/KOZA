(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,4839,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(64961),o=e.i(83494),a=e.i(60880),i=e.i(73767),l=e.i(34354),n=e.i(87315),c=e.i(95713);let u=(0,r.createContext)(null),d=[];e.s(["StoryProvider",0,({children:S})=>{let{user:y,firestoreEnabled:p}=(0,o.useAuth)(),{cloudSynced:g}=(0,a.useUser)(),f=(0,n.useStoryActor)(),m=(0,c.useSelector)(f,e=>e.context.stories),[h,E]=(0,r.useState)(""),[v,T]=(0,r.useState)(!1),[w,C]=(0,r.useState)(null),[b,R]=(0,r.useState)(null),[A,U]=(0,s.default)("koza-stories",[]);(0,r.useEffect)(()=>{A&&A.length>0&&f.send({type:"STORY.FETCH_SUCCESS",stories:A})},[]),(0,r.useEffect)(()=>{U(m)},[m,U]),(0,r.useEffect)(()=>{if(!y||!p||!g)return;f.send({type:"STORY.FETCH_START"}),(async()=>{try{let e=await i.getUserStories(y.uid);if(e){let t=new Map;m.forEach(e=>t.set(String(e.id),e)),e.forEach(e=>t.set(String(e.id),e));let r=Array.from(t.values()).sort((e,t)=>new Date(t.createdAt||0)-new Date(e.createdAt||0)).slice(0,50);f.send({type:"STORY.FETCH_SUCCESS",stories:r})}else f.send({type:"STORY.FETCH_SUCCESS",stories:m})}catch(e){console.error("Story load error:",e),f.send({type:"STORY.FETCH_FAILURE",error:e.message})}})();let e=i.subscribeToStories(y.uid,e=>{e&&f.send({type:"STORY.FETCH_SUCCESS",stories:e})});return()=>e()},[y,p,g,f]);let k=(0,r.useCallback)(async e=>{let t={id:String(Date.now()),...e,createdAt:new Date().toISOString()};f.send({type:"STORY.CREATE_START"}),f.send({type:"STORY.CREATE_SUCCESS",story:t}),R(t);let r="story"===e.type?"story_created":"game_created";if(l.analytics.track(r,{title:e.title}),y&&p)try{await i.saveStory(y.uid,t)}catch(e){console.error("Save story failed",e),f.send({type:"STORY.CREATE_FAILURE",error:e.message})}},[y,p,f]),P=(0,r.useCallback)(async e=>{let t=String(e);if(f.send({type:"STORY.DELETE",id:t}),y&&p)try{await i.deleteStory(y.uid,t)}catch(e){console.error("Delete story failed",e),f.send({type:"STORY.FETCH_START"})}},[y,p,f]),x=(0,r.useCallback)(async(t,r)=>{f.send({type:"STORY.REFINE_START"}),T(!0);try{let{NarrativeDomain:s}=await e.A(74877),o=await s.processRefinementRequest(t,r);if(o.isSafetyTriggered)return f.send({type:"STORY.REFINE_FAILURE",error:o.message}),{success:!1,message:o.message};let a=o.data;return f.send({type:"STORY.REFINE_SUCCESS",story:a}),l.analytics.track("story_refined",{title:a.title}),y&&p&&await i.saveStory(y.uid,a),{success:!0,story:a}}catch(e){return console.error("Refinement failed:",e),f.send({type:"STORY.REFINE_FAILURE",error:e.message}),{success:!1,message:e.message}}finally{T(!1)}},[y,p,f]),_=r.default.useMemo(()=>({savedStories:m,activeStory:h,setActiveStory:E,isProcessing:v,setIsProcessing:T,analysisResult:w,setAnalysisResult:C,lastSavedStory:b,setLastSavedStory:R,communityWorks:d,saveStory:k,deleteStory:P,refineStory:x}),[m,h,v,w,b,k,P,x]);return(0,t.jsx)(u.Provider,{value:_,children:S})},"useStory",0,()=>{let e=(0,r.useContext)(u);if(!e)throw Error("useStory must be used within StoryProvider");return e}])},53458,e=>{"use strict";e.s(["ANALYTICS_CONFIG",0,{measurementId:"G-V0PXH3NLY5"}])},60880,64961,73767,34354,e=>{"use strict";var t=e.i(43476),r=e.i(71645);function s(e,t){let[s,o]=(0,r.useState)(()=>{try{let r=window.localStorage.getItem(e),s=r?JSON.parse(r):t;return null!==s?s:t}catch(e){return console.log(e),t}});return[s,t=>{try{let r=t instanceof Function?t(s):t;o(r),window.localStorage.setItem(e,JSON.stringify(r))}catch(e){console.log(e)}}]}e.s(["default",()=>s],64961);var o=e.i(83494);e.i(36180);var a=e.i(98925),i=e.i(14389);let l=async e=>{if(!i.db)throw Error("Firestore not initialized");try{let t=(0,a.doc)(i.db,"users",e,"data","profile"),r=await (0,a.getDoc)(t);if(r.exists())return r.data();return null}catch(e){throw console.error("Error getting user profile:",e),e}},n=async(e,t)=>{if(!i.db)throw Error("Firestore not initialized");try{let r=(0,a.doc)(i.db,"users",e,"data","profile"),s={...t,createdAt:(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()};return await (0,a.setDoc)(r,s),s}catch(e){throw console.error("Error creating user profile:",e),e}},c=new Map,u=null,d=async e=>{if(!c.has(e)||!i.db)return;let t=c.get(e);c.delete(e);try{let r=(0,a.doc)(i.db,"users",e,"data","profile");await (0,a.updateDoc)(r,{...t,updatedAt:(0,a.serverTimestamp)()}),console.log(`â˜ï¸ Cloud Sync: Profile updated for ${e}`)}catch(r){console.error("Buffer Sync Error:",r),c.set(e,{...t,...c.get(e)})}},S=async(e,t)=>{if(!i.db)throw Error("Firestore not initialized");let r=c.get(e)||{};return c.set(e,{...r,...t}),u&&clearTimeout(u),u=setTimeout(()=>d(e),2e3),{...r,...t,buffered:!0}},y=async e=>{if(!i.db)throw Error("Firestore not initialized");try{let t=(0,a.collection)(i.db,"users",e,"stories"),r=(0,a.query)(t,(0,a.orderBy)("createdAt","desc"));return new Promise((e,t)=>{let s=(0,a.onSnapshot)(r,t=>{let r=[];t.forEach(e=>{r.push({id:e.id,...e.data()})}),s(),e(r)},e=>{s(),t(e)})})}catch(e){throw console.error("Error getting user stories:",e),e}},p=async(e,t)=>{if(!i.db)throw Error("Firestore not initialized");try{let r=String(t.id||Date.now()),s=(0,a.doc)(i.db,"users",e,"stories",r),o={...t,id:r,createdAt:t.createdAt||(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()};return await (0,a.setDoc)(s,o),{...o,id:r}}catch(e){throw console.error("Error saving story:",e),e}},g=async(e,t)=>{if(!i.db)throw Error("Firestore not initialized");try{let r=(0,a.doc)(i.db,"users",e,"stories",String(t));await (0,a.deleteDoc)(r)}catch(e){throw console.error("Error deleting story:",e),e}},f=(e,t)=>{if(!i.db)return console.warn("Firestore not initialized, skipping subscription"),()=>{};try{let r=(0,a.doc)(i.db,"users",e,"data","profile");return(0,a.onSnapshot)(r,e=>{e.exists()&&t(e.data())},e=>{console.error("Error in profile subscription:",e)})}catch(e){return console.error("Error subscribing to profile:",e),()=>{}}},m=async(e,t)=>{if(!i.db)throw Error("Firestore not initialized");try{let r=(0,a.writeBatch)(i.db);t.forEach(t=>{let s=String(t.id||Date.now()+Math.random()),o=(0,a.doc)(i.db,"users",e,"stories",s);r.set(o,{...t,id:s,createdAt:t.createdAt||(0,a.serverTimestamp)(),updatedAt:(0,a.serverTimestamp)()})}),await r.commit(),console.log(`âœ… Batch saved ${t.length} stories to cloud`)}catch(e){throw console.error("Error batch saving stories:",e),e}},h=async(e,t)=>{if(!i.db)return console.warn("Firestore not initialized, skipping cloud sync"),null;try{let r=await l(e),s=r;if(t.stories&&t.stories.length>0&&(console.log(`ðŸ“¤ Syncing ${t.stories.length} local stories to cloud...`),await m(e,t.stories)),!r)return console.log("ðŸ“¤ Creating initial cloud profile for user:",e),s={xp:t.user?.xp||0,level:t.user?.level||1,nextLevelXp:t.user?.nextLevelXp||1e3,totalXP:t.user?.totalXP||t.user?.xp||0,storiesCreated:t.user?.storiesCreated||0,gamesCreated:t.user?.gamesCreated||0,storiesRead:t.user?.storiesRead||0,gamesPlayed:t.user?.gamesPlayed||0,dailyStreak:t.user?.dailyStreak||0,lastVisit:t.user?.lastVisit||new Date().toISOString(),title:t.user?.title||"Empati Ã‡Ä±raÄŸÄ±",achievements:t.user?.achievements||[],badges:t.user?.badges||[]},await n(e,s),console.log("âœ… Migration complete"),{migrated:!0,profile:s};return console.log("ðŸ”„ Profile exists in cloud, prioritizing cloud stats"),{migrated:!1,profile:r}}catch(e){throw console.error("Error in syncLocalToCloud:",e),e}};e.s(["deleteStory",0,g,"getUserStories",0,y,"saveStory",0,p,"subscribeToProfile",0,f,"subscribeToStories",0,(e,t)=>{if(!i.db)return console.warn("Firestore not initialized, skipping subscription"),()=>{};try{let r=(0,a.collection)(i.db,"users",e,"stories"),s=(0,a.query)(r,(0,a.orderBy)("createdAt","desc"));return(0,a.onSnapshot)(s,e=>{let r=[];e.forEach(e=>{r.push({id:e.id,...e.data()})}),t(r)},e=>{console.error("Error in stories subscription:",e)})}catch(e){return console.error("Error subscribing to stories:",e),()=>{}}},"syncLocalToCloud",0,h,"updateUserProfile",0,S],73767);var E=e.i(44825);let v=new class{constructor(){this.events=[],this.sessionStart=Date.now()}track(e,t={}){let r={name:e,timestamp:Date.now(),sessionDuration:Date.now()-this.sessionStart,...t};this.events.push(r),this.saveToStorage(),E.googleAnalytics.trackEvent("app_interaction",e,t.label||"",t.value||void 0),console.log("ðŸ“Š Analytics:",e,t)}saveToStorage(){try{let e=[...JSON.parse(localStorage.getItem("koza-analytics")||"[]"),...this.events].slice(-100);localStorage.setItem("koza-analytics",JSON.stringify(e)),this.events=[]}catch(e){console.error("Failed to save analytics:",e)}}getStats(){try{let e=JSON.parse(localStorage.getItem("koza-analytics")||"[]");return{totalEvents:e.length,storiesCreated:e.filter(e=>"story_created"===e.name).length,gamesCreated:e.filter(e=>"game_created"===e.name).length,xpEarned:e.filter(e=>"xp_awarded"===e.name).reduce((e,t)=>e+(t.amount||0),0),lastActivity:e.length>0?e[e.length-1].timestamp:null}}catch{return null}}};e.s(["analytics",0,v],34354),e.i(21468);var T=e.i(87315),w=e.i(95713);let C=(0,r.createContext)(null),b={xp:850,level:1,nextLevelXp:1e3,storiesRead:3,gamesPlayed:1,storiesCreated:0,gamesCreated:0,totalXP:850,dailyStreak:0,lastVisit:null,title:"Empati Ã‡Ä±raÄŸÄ±",badges:[{id:1,name:"Ä°lk AdÄ±m",unlocked:!0},{id:2,name:"Hikaye AnlatÄ±cÄ±sÄ±",unlocked:!1},{id:3,name:"Topluluk YÄ±ldÄ±zÄ±",unlocked:!1}],achievements:[]};e.s(["UserProvider",0,({children:e})=>{let{user:a,firestoreEnabled:i}=(0,o.useAuth)(),l=(0,T.useUserActor)(),n=(0,w.useSelector)(l,e=>e.context.user),c=(0,w.useSelector)(l,e=>e.context.syncStatus),u="syncing"===c,d="synced"===c,[y,p]=s("koza-user",b);(0,r.useEffect)(()=>{y&&l.send({type:"USER.LOAD_DATA",data:y})},[]),(0,r.useEffect)(()=>{n&&p(n)},[n,p]);let[g,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=l.on("USER.AWARD_XP",e=>{});return()=>{e&&"function"==typeof e.unsubscribe&&e.unsubscribe()}},[l]);let[E,R]=(0,r.useState)(n);(0,r.useEffect)(()=>{if(!n||!E)return void R(n);if(n.level>E.level)m({type:"levelup",level:n.level});else if(n.xp>E.xp){let e=n.xp-E.xp;e>0&&m({type:"xp",amount:e,reason:"BaÅŸarÄ±m"})}n.achievements.length>E.achievements.length&&m({type:"achievement",achievements:n.achievements.filter(e=>!E.achievements.includes(e)).map(e=>({id:e,name:"Yeni BaÅŸarÄ±m",icon:"ðŸ†"}))}),R(n)},[n]),(0,r.useEffect)(()=>{let e=new Date().toDateString();if(!n)return;let t=n.lastVisit;if(t!==e){let r=new Date;r.setDate(r.getDate()-1);let s=t===r.toDateString()?n.dailyStreak+1:1;l.send({type:"USER.UPDATE_PROFILE",data:{lastVisit:e,dailyStreak:s}})}},[n?.lastVisit,l]),(0,r.useEffect)(()=>{a&&i&&!d&&(l.send({type:"USER.SYNC_START"}),(async()=>{try{console.log("ðŸ”„ User: Initiating full cloud synchronization...");let e=JSON.parse(localStorage.getItem("koza-stories")||"[]"),t=n||y,r=await h(a.uid,{user:t,stories:e});r&&r.profile?(l.send({type:"USER.UPDATE_PROFILE",data:r.profile}),l.send({type:"USER.SYNC_SUCCESS"}),r.migrated&&console.log("âœ… Local data successfully migrated to cloud")):l.send({type:"USER.SYNC_SUCCESS"})}catch(e){console.error("User Sync error:",e),l.send({type:"USER.SYNC_FAILURE",error:e.message})}})())},[a,i,d,l]),(0,r.useEffect)(()=>{if(!a||!i||!d)return;let e=f(a.uid,e=>{e&&l.send({type:"USER.UPDATE_PROFILE",data:e})});return()=>e()},[a,i,d,l]),(0,r.useEffect)(()=>{if(!a||!i||!d||!n)return;let e=setTimeout(()=>{S(a.uid,{xp:n.xp,level:n.level,nextLevelXp:n.nextLevelXp,totalXP:n.totalXP,storiesCreated:n.storiesCreated,gamesCreated:n.gamesCreated,storiesRead:n.storiesRead,gamesPlayed:n.gamesPlayed,dailyStreak:n.dailyStreak,lastVisit:n.lastVisit,title:n.title,achievements:n.achievements,badges:n.badges}).catch(e=>console.error("Background sync error:",e))},2e3);return()=>clearTimeout(e)},[n,a,i,d]);let A=(0,r.useCallback)((e,t)=>{v.track("xp_awarded",{amount:e,reason:t}),l.send({type:"USER.AWARD_XP",amount:e}),m({type:"xp",amount:e,reason:t})},[l]),U=(0,r.useCallback)(e=>{let t;t="function"==typeof e?e(l.getSnapshot().context.user||b):e,l.send({type:"USER.UPDATE_PROFILE",data:t})},[l]),k=r.default.useMemo(()=>({user:n,setUser:U,awardXP:A,isSyncing:u,cloudSynced:d,lastUserEvent:g,setLastUserEvent:m}),[n,U,A,u,d,g,m]);return(0,t.jsx)(C.Provider,{value:k,children:e})},"useUser",0,()=>{let e=(0,r.useContext)(C);if(!e)throw Error("useUser must be used within UserProvider");return e}],60880)},25487,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let s=(0,r.createContext)(null);e.s(["UIProvider",0,({children:e})=>{let[o,a]=(0,r.useState)(null),[i,l]=(0,r.useState)("create"),[n,c]=(0,r.useState)(null),[u,d]=(0,r.useState)([]),[S,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{localStorage.getItem("koza-onboarding-complete")||y(!0)},[]);let p=(0,r.useCallback)((e,t,r)=>{let s=Date.now();d(o=>[...o,{id:s,type:e,title:t,message:r}]),setTimeout(()=>{d(e=>e.filter(e=>e.id!==s))},3e3)},[]),g=(0,r.useCallback)((e,t,r)=>{c({type:e,title:t,message:r}),setTimeout(()=>c(null),3e3)},[]);return(0,t.jsx)(s.Provider,{value:{currentView:o,setCurrentView:a,activeTab:i,setActiveTab:l,notification:n,setNotification:c,triggerNotification:g,toasts:u,setToasts:d,addToast:p,showOnboarding:S,setShowOnboarding:y},children:e})},"useUI",0,()=>{let e=(0,r.useContext)(s);if(!e)throw Error("useUI must be used within UIProvider");return e}])},78894,e=>{"use strict";let t=(0,e.i(75254).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],78894)},74877,e=>{e.v(t=>Promise.all(["static/chunks/0539a351cd5474c9.js"].map(t=>e.l(t))).then(()=>t(80763)))}]);