(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,53458,e=>{"use strict";e.s(["ANALYTICS_CONFIG",0,{measurementId:"G-V0PXH3NLY5"}])},75254,e=>{"use strict";var t=e.i(71645);let r=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},s=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim();var a={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)(({color:e="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:l="",children:n,iconNode:u,...c},d)=>(0,t.createElement)("svg",{ref:d,...a,width:r,height:r,stroke:e,strokeWidth:o?24*Number(i)/Number(r):i,className:s("lucide",l),...!n&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(c)&&{"aria-hidden":"true"},...c},[...u.map(([e,r])=>(0,t.createElement)(e,r)),...Array.isArray(n)?n:[n]])),o=(e,a)=>{let o=(0,t.forwardRef)(({className:o,...l},n)=>(0,t.createElement)(i,{ref:n,iconNode:a,className:s(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,o),...l}));return o.displayName=r(e),o};e.s(["default",()=>o],75254)},25487,e=>{"use strict";var t=e.i(43476),r=e.i(71645);let s=(0,r.createContext)(null);e.s(["UIProvider",0,({children:e})=>{let[a,i]=(0,r.useState)(null),[o,l]=(0,r.useState)("create"),[n,u]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[S,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{localStorage.getItem("koza-onboarding-complete")||y(!0)},[]);let E=(0,r.useCallback)((e,t,r)=>{let s=Date.now();d(a=>[...a,{id:s,type:e,title:t,message:r}]),setTimeout(()=>{d(e=>e.filter(e=>e.id!==s))},3e3)},[]),T=(0,r.useCallback)((e,t,r)=>{u({type:e,title:t,message:r}),setTimeout(()=>u(null),3e3)},[]);return(0,t.jsx)(s.Provider,{value:{currentView:a,setCurrentView:i,activeTab:o,setActiveTab:l,notification:n,setNotification:u,triggerNotification:T,toasts:c,setToasts:d,addToast:E,showOnboarding:S,setShowOnboarding:y},children:e})},"useUI",0,()=>{let e=(0,r.useContext)(s);if(!e)throw Error("useUI must be used within UIProvider");return e}])},4839,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(64961),a=e.i(83494),i=e.i(60880),o=e.i(73767),l=e.i(34354),n=e.i(87315),u=e.i(95713);let c=(0,r.createContext)(null),d=[];e.s(["StoryProvider",0,({children:S})=>{let{user:y,firestoreEnabled:E}=(0,a.useAuth)(),{cloudSynced:T}=(0,i.useUser)(),m=(0,n.useStoryActor)(),f=(0,u.useSelector)(m,e=>e.context.stories),[C,p]=(0,r.useState)(""),[h,R]=(0,r.useState)(!1),[g,w]=(0,r.useState)(null),[A,v]=(0,r.useState)(null),[k,O]=(0,s.default)("koza-stories",[]);(0,r.useEffect)(()=>{k&&k.length>0&&m.send({type:"STORY.FETCH_SUCCESS",stories:k})},[]),(0,r.useEffect)(()=>{O(f)},[f,O]),(0,r.useEffect)(()=>{if(!y||!E||!T)return;m.send({type:"STORY.FETCH_START"}),(async()=>{try{let e=await o.getUserStories(y.uid);if(e){let t=new Map;f.forEach(e=>t.set(String(e.id),e)),e.forEach(e=>t.set(String(e.id),e));let r=Array.from(t.values()).sort((e,t)=>new Date(t.createdAt||0)-new Date(e.createdAt||0)).slice(0,50);m.send({type:"STORY.FETCH_SUCCESS",stories:r})}else m.send({type:"STORY.FETCH_SUCCESS",stories:f})}catch(e){console.error("Story load error:",e),m.send({type:"STORY.FETCH_FAILURE",error:e.message})}})();let e=o.subscribeToStories(y.uid,e=>{e&&m.send({type:"STORY.FETCH_SUCCESS",stories:e})});return()=>e()},[y,E,T,m]);let U=(0,r.useCallback)(async e=>{let t={id:String(Date.now()),...e,createdAt:new Date().toISOString()};m.send({type:"STORY.CREATE_START"}),m.send({type:"STORY.CREATE_SUCCESS",story:t}),v(t);let r="story"===e.type?"story_created":"game_created";if(l.analytics.track(r,{title:e.title}),y&&E)try{await o.saveStory(y.uid,t)}catch(e){console.error("Save story failed",e),m.send({type:"STORY.CREATE_FAILURE",error:e.message})}},[y,E,m]),_=(0,r.useCallback)(async e=>{let t=String(e);if(m.send({type:"STORY.DELETE",id:t}),y&&E)try{await o.deleteStory(y.uid,t)}catch(e){console.error("Delete story failed",e),m.send({type:"STORY.FETCH_START"})}},[y,E,m]),I=(0,r.useCallback)(async(t,r)=>{m.send({type:"STORY.REFINE_START"}),R(!0);try{let{NarrativeDomain:s}=await e.A(74877),a=await s.processRefinementRequest(t,r);if(a.isSafetyTriggered)return m.send({type:"STORY.REFINE_FAILURE",error:a.message}),{success:!1,message:a.message};let i=a.data;return m.send({type:"STORY.REFINE_SUCCESS",story:i}),l.analytics.track("story_refined",{title:i.title}),y&&E&&await o.saveStory(y.uid,i),{success:!0,story:i}}catch(e){return console.error("Refinement failed:",e),m.send({type:"STORY.REFINE_FAILURE",error:e.message}),{success:!1,message:e.message}}finally{R(!1)}},[y,E,m]),Y=r.default.useMemo(()=>({savedStories:f,activeStory:C,setActiveStory:p,isProcessing:h,setIsProcessing:R,analysisResult:g,setAnalysisResult:w,lastSavedStory:A,setLastSavedStory:v,communityWorks:d,saveStory:U,deleteStory:_,refineStory:I}),[f,C,h,g,A,U,_,I]);return(0,t.jsx)(c.Provider,{value:Y,children:S})},"useStory",0,()=>{let e=(0,r.useContext)(c);if(!e)throw Error("useStory must be used within StoryProvider");return e}])},78894,e=>{"use strict";let t=(0,e.i(75254).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>t],78894)},81809,e=>{e.v(t=>Promise.all(["static/chunks/cca95befd3c1c316.js"].map(t=>e.l(t))).then(()=>t(80411)))},74877,e=>{e.v(t=>Promise.all(["static/chunks/0539a351cd5474c9.js"].map(t=>e.l(t))).then(()=>t(80763)))}]);