module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},99121,a=>{"use strict";a.s(["ANALYTICS_CONFIG",0,{measurementId:"G-V0PXH3NLY5"}])},51480,29512,79848,76455,a=>{"use strict";var b=a.i(87924),c=a.i(72131);function d(a,b){let[d,e]=(0,c.useState)(()=>b);return[d,a=>{try{let b=a instanceof Function?a(d):a;e(b)}catch(a){console.log(a)}}]}a.s(["default",()=>d],29512);var e=a.i(29338);a.i(69387);var f=a.i(60574),g=a.i(26795);let h=async a=>{if(!g.db)throw Error("Firestore not initialized");try{let b=(0,f.doc)(g.db,"users",a,"data","profile"),c=await (0,f.getDoc)(b);if(c.exists())return c.data();return null}catch(a){throw console.error("Error getting user profile:",a),a}},i=async(a,b)=>{if(!g.db)throw Error("Firestore not initialized");try{let c=(0,f.doc)(g.db,"users",a,"data","profile"),d={...b,createdAt:(0,f.serverTimestamp)(),updatedAt:(0,f.serverTimestamp)()};return await (0,f.setDoc)(c,d),d}catch(a){throw console.error("Error creating user profile:",a),a}},j=new Map,k=null,l=async a=>{if(!j.has(a)||!g.db)return;let b=j.get(a);j.delete(a);try{let c=(0,f.doc)(g.db,"users",a,"data","profile");await (0,f.updateDoc)(c,{...b,updatedAt:(0,f.serverTimestamp)()}),console.log(`â˜ï¸ Cloud Sync: Profile updated for ${a}`)}catch(c){console.error("Buffer Sync Error:",c),j.set(a,{...b,...j.get(a)})}},m=async(a,b)=>{if(!g.db)throw Error("Firestore not initialized");let c=j.get(a)||{};return j.set(a,{...c,...b}),k&&clearTimeout(k),k=setTimeout(()=>l(a),2e3),{...c,...b,buffered:!0}},n=async a=>{if(!g.db)throw Error("Firestore not initialized");try{let b=(0,f.collection)(g.db,"users",a,"stories"),c=(0,f.query)(b,(0,f.orderBy)("createdAt","desc"));return new Promise((a,b)=>{let d=(0,f.onSnapshot)(c,b=>{let c=[];b.forEach(a=>{c.push({id:a.id,...a.data()})}),d(),a(c)},a=>{d(),b(a)})})}catch(a){throw console.error("Error getting user stories:",a),a}},o=async(a,b)=>{if(!g.db)throw Error("Firestore not initialized");try{let c=String(b.id||Date.now()),d=(0,f.doc)(g.db,"users",a,"stories",c),e={...b,id:c,createdAt:b.createdAt||(0,f.serverTimestamp)(),updatedAt:(0,f.serverTimestamp)()};return await (0,f.setDoc)(d,e),{...e,id:c}}catch(a){throw console.error("Error saving story:",a),a}},p=async(a,b)=>{if(!g.db)throw Error("Firestore not initialized");try{let c=(0,f.doc)(g.db,"users",a,"stories",String(b));await (0,f.deleteDoc)(c)}catch(a){throw console.error("Error deleting story:",a),a}},q=(a,b)=>{if(!g.db)return console.warn("Firestore not initialized, skipping subscription"),()=>{};try{let c=(0,f.doc)(g.db,"users",a,"data","profile");return(0,f.onSnapshot)(c,a=>{a.exists()&&b(a.data())},a=>{console.error("Error in profile subscription:",a)})}catch(a){return console.error("Error subscribing to profile:",a),()=>{}}},r=async(a,b)=>{if(!g.db)throw Error("Firestore not initialized");try{let c=(0,f.writeBatch)(g.db);b.forEach(b=>{let d=String(b.id||Date.now()+Math.random()),e=(0,f.doc)(g.db,"users",a,"stories",d);c.set(e,{...b,id:d,createdAt:b.createdAt||(0,f.serverTimestamp)(),updatedAt:(0,f.serverTimestamp)()})}),await c.commit(),console.log(`âœ… Batch saved ${b.length} stories to cloud`)}catch(a){throw console.error("Error batch saving stories:",a),a}},s=async(a,b)=>{if(!g.db)return console.warn("Firestore not initialized, skipping cloud sync"),null;try{let c=await h(a),d=c;if(b.stories&&b.stories.length>0&&(console.log(`ðŸ“¤ Syncing ${b.stories.length} local stories to cloud...`),await r(a,b.stories)),!c)return console.log("ðŸ“¤ Creating initial cloud profile for user:",a),d={xp:b.user?.xp||0,level:b.user?.level||1,nextLevelXp:b.user?.nextLevelXp||1e3,totalXP:b.user?.totalXP||b.user?.xp||0,storiesCreated:b.user?.storiesCreated||0,gamesCreated:b.user?.gamesCreated||0,storiesRead:b.user?.storiesRead||0,gamesPlayed:b.user?.gamesPlayed||0,dailyStreak:b.user?.dailyStreak||0,lastVisit:b.user?.lastVisit||new Date().toISOString(),title:b.user?.title||"Empati Ã‡Ä±raÄŸÄ±",achievements:b.user?.achievements||[],badges:b.user?.badges||[]},await i(a,d),console.log("âœ… Migration complete"),{migrated:!0,profile:d};return console.log("ðŸ”„ Profile exists in cloud, prioritizing cloud stats"),{migrated:!1,profile:c}}catch(a){throw console.error("Error in syncLocalToCloud:",a),a}};a.s(["deleteStory",0,p,"getUserStories",0,n,"saveStory",0,o,"subscribeToProfile",0,q,"subscribeToStories",0,(a,b)=>{if(!g.db)return console.warn("Firestore not initialized, skipping subscription"),()=>{};try{let c=(0,f.collection)(g.db,"users",a,"stories"),d=(0,f.query)(c,(0,f.orderBy)("createdAt","desc"));return(0,f.onSnapshot)(d,a=>{let c=[];a.forEach(a=>{c.push({id:a.id,...a.data()})}),b(c)},a=>{console.error("Error in stories subscription:",a)})}catch(a){return console.error("Error subscribing to stories:",a),()=>{}}},"syncLocalToCloud",0,s,"updateUserProfile",0,m],79848);var t=a.i(25735);let u=new class{constructor(){this.events=[],this.sessionStart=Date.now()}track(a,b={}){let c={name:a,timestamp:Date.now(),sessionDuration:Date.now()-this.sessionStart,...b};this.events.push(c),this.saveToStorage(),t.googleAnalytics.trackEvent("app_interaction",a,b.label||"",b.value||void 0),console.log("ðŸ“Š Analytics:",a,b)}saveToStorage(){try{let a=[...JSON.parse(localStorage.getItem("koza-analytics")||"[]"),...this.events].slice(-100);localStorage.setItem("koza-analytics",JSON.stringify(a)),this.events=[]}catch(a){console.error("Failed to save analytics:",a)}}getStats(){try{let a=JSON.parse(localStorage.getItem("koza-analytics")||"[]");return{totalEvents:a.length,storiesCreated:a.filter(a=>"story_created"===a.name).length,gamesCreated:a.filter(a=>"game_created"===a.name).length,xpEarned:a.filter(a=>"xp_awarded"===a.name).reduce((a,b)=>a+(b.amount||0),0),lastActivity:a.length>0?a[a.length-1].timestamp:null}}catch{return null}}};a.s(["analytics",0,u],76455),a.i(34703);var v=a.i(89236),w=a.i(75235);let x=(0,c.createContext)(null),y={xp:850,level:1,nextLevelXp:1e3,storiesRead:3,gamesPlayed:1,storiesCreated:0,gamesCreated:0,totalXP:850,dailyStreak:0,lastVisit:null,title:"Empati Ã‡Ä±raÄŸÄ±",badges:[{id:1,name:"Ä°lk AdÄ±m",unlocked:!0},{id:2,name:"Hikaye AnlatÄ±cÄ±sÄ±",unlocked:!1},{id:3,name:"Topluluk YÄ±ldÄ±zÄ±",unlocked:!1}],achievements:[]};a.s(["UserProvider",0,({children:a})=>{let{user:f,firestoreEnabled:g}=(0,e.useAuth)(),h=(0,v.useUserActor)(),i=(0,w.useSelector)(h,a=>a.context.user),j=(0,w.useSelector)(h,a=>a.context.syncStatus),k="syncing"===j,l="synced"===j,[n,o]=d("koza-user",y);(0,c.useEffect)(()=>{n&&h.send({type:"USER.LOAD_DATA",data:n})},[]),(0,c.useEffect)(()=>{i&&o(i)},[i,o]);let[p,r]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=h.on("USER.AWARD_XP",a=>{});return()=>{a&&"function"==typeof a.unsubscribe&&a.unsubscribe()}},[h]);let[t,z]=(0,c.useState)(i);(0,c.useEffect)(()=>{if(!i||!t)return void z(i);if(i.level>t.level)r({type:"levelup",level:i.level});else if(i.xp>t.xp){let a=i.xp-t.xp;a>0&&r({type:"xp",amount:a,reason:"BaÅŸarÄ±m"})}i.achievements.length>t.achievements.length&&r({type:"achievement",achievements:i.achievements.filter(a=>!t.achievements.includes(a)).map(a=>({id:a,name:"Yeni BaÅŸarÄ±m",icon:"ðŸ†"}))}),z(i)},[i]),(0,c.useEffect)(()=>{let a=new Date().toDateString();if(!i)return;let b=i.lastVisit;if(b!==a){let c=new Date;c.setDate(c.getDate()-1);let d=b===c.toDateString()?i.dailyStreak+1:1;h.send({type:"USER.UPDATE_PROFILE",data:{lastVisit:a,dailyStreak:d}})}},[i?.lastVisit,h]),(0,c.useEffect)(()=>{f&&g&&!l&&(h.send({type:"USER.SYNC_START"}),(async()=>{try{console.log("ðŸ”„ User: Initiating full cloud synchronization...");let a=JSON.parse(localStorage.getItem("koza-stories")||"[]"),b=i||n,c=await s(f.uid,{user:b,stories:a});c&&c.profile?(h.send({type:"USER.UPDATE_PROFILE",data:c.profile}),h.send({type:"USER.SYNC_SUCCESS"}),c.migrated&&console.log("âœ… Local data successfully migrated to cloud")):h.send({type:"USER.SYNC_SUCCESS"})}catch(a){console.error("User Sync error:",a),h.send({type:"USER.SYNC_FAILURE",error:a.message})}})())},[f,g,l,h]),(0,c.useEffect)(()=>{if(!f||!g||!l)return;let a=q(f.uid,a=>{a&&h.send({type:"USER.UPDATE_PROFILE",data:a})});return()=>a()},[f,g,l,h]),(0,c.useEffect)(()=>{if(!f||!g||!l||!i)return;let a=setTimeout(()=>{m(f.uid,{xp:i.xp,level:i.level,nextLevelXp:i.nextLevelXp,totalXP:i.totalXP,storiesCreated:i.storiesCreated,gamesCreated:i.gamesCreated,storiesRead:i.storiesRead,gamesPlayed:i.gamesPlayed,dailyStreak:i.dailyStreak,lastVisit:i.lastVisit,title:i.title,achievements:i.achievements,badges:i.badges}).catch(a=>console.error("Background sync error:",a))},2e3);return()=>clearTimeout(a)},[i,f,g,l]);let A=(0,c.useCallback)((a,b)=>{u.track("xp_awarded",{amount:a,reason:b}),h.send({type:"USER.AWARD_XP",amount:a}),r({type:"xp",amount:a,reason:b})},[h]),B=(0,c.useCallback)(a=>{let b;b="function"==typeof a?a(h.getSnapshot().context.user||y):a,h.send({type:"USER.UPDATE_PROFILE",data:b})},[h]),C=c.default.useMemo(()=>({user:i,setUser:B,awardXP:A,isSyncing:k,cloudSynced:l,lastUserEvent:p,setLastUserEvent:r}),[i,B,A,k,l,p,r]);return(0,b.jsx)(x.Provider,{value:C,children:a})},"useUser",0,()=>{let a=(0,c.useContext)(x);if(!a)throw Error("useUser must be used within UserProvider");return a}],51480)},61542,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=(0,c.createContext)(null);a.s(["UIProvider",0,({children:a})=>{let[e,f]=(0,c.useState)(null),[g,h]=(0,c.useState)("create"),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!1);(0,c.useEffect)(()=>{localStorage.getItem("koza-onboarding-complete")||n(!0)},[]);let o=(0,c.useCallback)((a,b,c)=>{let d=Date.now();l(e=>[...e,{id:d,type:a,title:b,message:c}]),setTimeout(()=>{l(a=>a.filter(a=>a.id!==d))},3e3)},[]),p=(0,c.useCallback)((a,b,c)=>{j({type:a,title:b,message:c}),setTimeout(()=>j(null),3e3)},[]);return(0,b.jsx)(d.Provider,{value:{currentView:e,setCurrentView:f,activeTab:g,setActiveTab:h,notification:i,setNotification:j,triggerNotification:p,toasts:k,setToasts:l,addToast:o,showOnboarding:m,setShowOnboarding:n},children:a})},"useUI",0,()=>{let a=(0,c.useContext)(d);if(!a)throw Error("useUI must be used within UIProvider");return a}])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1dd29a28._.js.map