{"version":3,"sources":["../../../../src/tabs/CommunityTab.jsx"],"sourcesContent":["'use client';\nimport { useAuth } from '../context/AuthContext';\nimport { useUser } from '../context/UserContext';\nimport { getPublicFeed } from '../services/firestoreService';\n\nconst CommunityTab = () => {\n    const [activeTab, setActiveTab] = useState('local');\n    const [posts, setPosts] = useState([]);\n    const [lastDoc, setLastDoc] = useState(null);\n    const [loading, setLoading] = useState(false);\n    const [initialLoading, setInitialLoading] = useState(true);\n    const [hasMore, setHasMore] = useState(true);\n    const [error, setError] = useState(null);\n    const sentinelRef = useRef(null);\n\n    const { user: authUser } = useAuth();\n    const { user: profile } = useUser();\n\n    // User data for composer\n    const currentUserId = authUser?.uid || null;\n    const userName = profile?.displayName || authUser?.displayName || 'Gezgin';\n    const avatarUrl = profile?.avatarUrl || authUser?.photoURL || '';\n\n    const fetchFeed = useCallback(async (reset = false) => {\n        if (loading && !reset) return;\n        setLoading(true);\n        setError(null);\n\n        try {\n            const feedResult = await getPublicFeed(activeTab, reset ? null : lastDoc);\n\n            setPosts(prev => reset ? feedResult.posts : [...prev, ...feedResult.posts]);\n            setLastDoc(feedResult.lastDoc);\n            setHasMore(feedResult.posts.length >= 20 && !!feedResult.lastDoc);\n        } catch (e) {\n            console.error('Feed error:', e);\n            setError('Paylaşımlar yüklenemedi. Lütfen internet bağlantınızı kontrol edin.');\n        } finally {\n            setLoading(false);\n            setInitialLoading(false);\n        }\n    }, [activeTab, lastDoc, loading]);\n\n    // Reset on tab change\n    useEffect(() => {\n        setInitialLoading(true);\n        setPosts([]);\n        setCursor(null);\n        setHasMore(true);\n        fetchFeed(true);\n    }, [activeTab]);\n\n    // Infinite scroll using IntersectionObserver\n    useEffect(() => {\n        if (!hasMore || loading || error) return;\n        const observer = new IntersectionObserver(entries => {\n            if (entries[0].isIntersecting) fetchFeed(false);\n        }, { threshold: 0.1 });\n        if (sentinelRef.current) observer.observe(sentinelRef.current);\n        return () => observer.disconnect();\n    }, [hasMore, loading, fetchFeed]);\n\n    return (\n        <div className=\"flex-1 flex flex-col h-full overflow-hidden\">\n            {/* Tab Bar */}\n            <div className=\"flex items-center justify-between px-4 pt-4 pb-0 shrink-0\">\n                <div className=\"flex gap-1 bg-neutral-900 border border-neutral-800 rounded-xl p-1\">\n                    {TABS.map(tab => (\n                        <button\n                            key={tab.id}\n                            onClick={() => setActiveTab(tab.id)}\n                            className={`px-4 py-1.5 text-xs font-semibold rounded-lg transition-all ${activeTab === tab.id\n                                ? 'bg-primary-600 text-white shadow-lg shadow-primary-500/20'\n                                : 'text-neutral-400 hover:text-white'\n                                }`}\n                        >\n                            {tab.label}\n                        </button>\n                    ))}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <button\n                        onClick={() => fetchFeed(true)}\n                        disabled={loading}\n                        className=\"p-2 rounded-xl text-neutral-500 hover:text-white hover:bg-neutral-800 transition-colors disabled:opacity-30\"\n                        title=\"Yenile\"\n                    >\n                        <RefreshCw size={15} className={loading ? 'animate-spin' : ''} />\n                    </button>\n                    <NotificationCenter currentUserId={currentUserId} />\n                </div>\n            </div>\n\n            {/* Feed */}\n            <div className=\"flex-1 overflow-y-auto px-4 py-4 space-y-0\">\n                <PostComposer\n                    currentUserId={currentUserId}\n                    userName={userName}\n                    avatarUrl={avatarUrl}\n                    onPostSuccess={() => fetchFeed(true)}\n                />\n\n                {initialLoading && (\n                    <div className=\"flex items-center justify-center py-20\">\n                        <div className=\"text-center\">\n                            <Loader2 className=\"w-8 h-8 text-primary-500 animate-spin mx-auto mb-3\" />\n                            <p className=\"text-sm text-neutral-500\">Topluluk yükleniyor...</p>\n                        </div>\n                    </div>\n                )}\n\n                {error && !initialLoading && (\n                    <div className=\"bg-red-950/30 border border-red-900/50 rounded-2xl p-6 text-center\">\n                        <p className=\"text-sm text-red-400 mb-3\">{error}</p>\n                        <button\n                            onClick={() => fetchFeed(true)}\n                            className=\"text-xs text-red-300 hover:text-white\"\n                        >\n                            Tekrar Dene\n                        </button>\n                    </div>\n                )}\n\n                {!initialLoading && !error && posts.length === 0 && (\n                    <div className=\"flex flex-col items-center justify-center py-20 text-center\">\n                        <Hash className=\"w-10 h-10 text-neutral-700 mb-4\" />\n                        <p className=\"text-neutral-500 text-sm\">Henüz gönderi yok.</p>\n                        <p className=\"text-neutral-700 text-xs mt-1\">İlk paylaşımı sen yap!</p>\n                    </div>\n                )}\n\n                <div className=\"space-y-3\">\n                    {posts.map(post => (\n                        <PostCard key={post.id} post={post} />\n                    ))}\n                </div>\n\n                {/* Infinite Scroll Sentinel */}\n                <div ref={sentinelRef} className=\"h-10 flex items-center justify-center\">\n                    {loading && !initialLoading && (\n                        <Loader2 className=\"w-5 h-5 text-neutral-600 animate-spin\" />\n                    )}\n                    {!hasMore && posts.length > 0 && (\n                        <p className=\"text-xs text-neutral-700\">Tüm gönderiler yüklendi</p>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CommunityTab;\n"],"names":[],"mappings":"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"}