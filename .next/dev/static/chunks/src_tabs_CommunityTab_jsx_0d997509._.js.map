{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/orwell/KOZA/src/tabs/CommunityTab.jsx"],"sourcesContent":["'use client';\nimport { useAuth } from '../context/AuthContext';\nimport { useUser } from '../context/UserContext';\nimport { getPublicFeed } from '../services/firestoreService';\n\nconst CommunityTab = () => {\n    const [activeTab, setActiveTab] = useState('local');\n    const [posts, setPosts] = useState([]);\n    const [lastDoc, setLastDoc] = useState(null);\n    const [loading, setLoading] = useState(false);\n    const [initialLoading, setInitialLoading] = useState(true);\n    const [hasMore, setHasMore] = useState(true);\n    const [error, setError] = useState(null);\n    const sentinelRef = useRef(null);\n\n    const { user: authUser } = useAuth();\n    const { user: profile } = useUser();\n\n    // User data for composer\n    const currentUserId = authUser?.uid || null;\n    const userName = profile?.displayName || authUser?.displayName || 'Gezgin';\n    const avatarUrl = profile?.avatarUrl || authUser?.photoURL || '';\n\n    const fetchFeed = useCallback(async (reset = false) => {\n        if (loading && !reset) return;\n        setLoading(true);\n        setError(null);\n\n        try {\n            const feedResult = await getPublicFeed(activeTab, reset ? null : lastDoc);\n\n            setPosts(prev => reset ? feedResult.posts : [...prev, ...feedResult.posts]);\n            setLastDoc(feedResult.lastDoc);\n            setHasMore(feedResult.posts.length >= 20 && !!feedResult.lastDoc);\n        } catch (e) {\n            console.error('Feed error:', e);\n            setError('Paylaşımlar yüklenemedi. Lütfen internet bağlantınızı kontrol edin.');\n        } finally {\n            setLoading(false);\n            setInitialLoading(false);\n        }\n    }, [activeTab, lastDoc, loading]);\n\n    // Reset on tab change\n    useEffect(() => {\n        setInitialLoading(true);\n        setPosts([]);\n        setCursor(null);\n        setHasMore(true);\n        fetchFeed(true);\n    }, [activeTab]);\n\n    // Infinite scroll using IntersectionObserver\n    useEffect(() => {\n        if (!hasMore || loading || error) return;\n        const observer = new IntersectionObserver(entries => {\n            if (entries[0].isIntersecting) fetchFeed(false);\n        }, { threshold: 0.1 });\n        if (sentinelRef.current) observer.observe(sentinelRef.current);\n        return () => observer.disconnect();\n    }, [hasMore, loading, fetchFeed]);\n\n    return (\n        <div className=\"flex-1 flex flex-col h-full overflow-hidden\">\n            {/* Tab Bar */}\n            <div className=\"flex items-center justify-between px-4 pt-4 pb-0 shrink-0\">\n                <div className=\"flex gap-1 bg-neutral-900 border border-neutral-800 rounded-xl p-1\">\n                    {TABS.map(tab => (\n                        <button\n                            key={tab.id}\n                            onClick={() => setActiveTab(tab.id)}\n                            className={`px-4 py-1.5 text-xs font-semibold rounded-lg transition-all ${activeTab === tab.id\n                                ? 'bg-primary-600 text-white shadow-lg shadow-primary-500/20'\n                                : 'text-neutral-400 hover:text-white'\n                                }`}\n                        >\n                            {tab.label}\n                        </button>\n                    ))}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <button\n                        onClick={() => fetchFeed(true)}\n                        disabled={loading}\n                        className=\"p-2 rounded-xl text-neutral-500 hover:text-white hover:bg-neutral-800 transition-colors disabled:opacity-30\"\n                        title=\"Yenile\"\n                    >\n                        <RefreshCw size={15} className={loading ? 'animate-spin' : ''} />\n                    </button>\n                    <NotificationCenter currentUserId={currentUserId} />\n                </div>\n            </div>\n\n            {/* Feed */}\n            <div className=\"flex-1 overflow-y-auto px-4 py-4 space-y-0\">\n                <PostComposer\n                    currentUserId={currentUserId}\n                    userName={userName}\n                    avatarUrl={avatarUrl}\n                    onPostSuccess={() => fetchFeed(true)}\n                />\n\n                {initialLoading && (\n                    <div className=\"flex items-center justify-center py-20\">\n                        <div className=\"text-center\">\n                            <Loader2 className=\"w-8 h-8 text-primary-500 animate-spin mx-auto mb-3\" />\n                            <p className=\"text-sm text-neutral-500\">Topluluk yükleniyor...</p>\n                        </div>\n                    </div>\n                )}\n\n                {error && !initialLoading && (\n                    <div className=\"bg-red-950/30 border border-red-900/50 rounded-2xl p-6 text-center\">\n                        <p className=\"text-sm text-red-400 mb-3\">{error}</p>\n                        <button\n                            onClick={() => fetchFeed(true)}\n                            className=\"text-xs text-red-300 hover:text-white\"\n                        >\n                            Tekrar Dene\n                        </button>\n                    </div>\n                )}\n\n                {!initialLoading && !error && posts.length === 0 && (\n                    <div className=\"flex flex-col items-center justify-center py-20 text-center\">\n                        <Hash className=\"w-10 h-10 text-neutral-700 mb-4\" />\n                        <p className=\"text-neutral-500 text-sm\">Henüz gönderi yok.</p>\n                        <p className=\"text-neutral-700 text-xs mt-1\">İlk paylaşımı sen yap!</p>\n                    </div>\n                )}\n\n                <div className=\"space-y-3\">\n                    {posts.map(post => (\n                        <PostCard key={post.id} post={post} />\n                    ))}\n                </div>\n\n                {/* Infinite Scroll Sentinel */}\n                <div ref={sentinelRef} className=\"h-10 flex items-center justify-center\">\n                    {loading && !initialLoading && (\n                        <Loader2 className=\"w-5 h-5 text-neutral-600 animate-spin\" />\n                    )}\n                    {!hasMore && posts.length > 0 && (\n                        <p className=\"text-xs text-neutral-700\">Tüm gönderiler yüklendi</p>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default CommunityTab;\n"],"names":[],"mappings":"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"}}]
}